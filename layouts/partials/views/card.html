{{ $item := .item }}

{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

{{ $resource := partial "functions/get_featured_image.html" $item }}
{{ $hover := cond (isset $item.Params "hover_image") ($item.Resources.GetMatch $item.Params.hover_image) nil }}
{{ $anchor := $item.Params.image.focal_point | default "Center" }}
{{ $fill_image := .config.fill_image | default true }}
{{ $showDate := .config.show_date | default true }}
{{ $showReadTime := .config.show_read_time | default true }}
{{ $showReadMore := .config.show_read_more | default true }}
{{ $hasMeta := or $showDate $showReadTime $showReadMore }}
{{ $index := .index }}

<div class="group bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm rounded-2xl ring-1 ring-zinc-900/5 dark:ring-white/10 shadow-lg overflow-hidden transition-all duration-300 ease-out hover:shadow-xl hover:shadow-blue-500/10 hover:-translate-y-2 focus-within:ring-2 focus-within:ring-blue-500/50" role="article" aria-labelledby="card-title-{{ $item.File.UniqueID }}">
    <!-- Image Section -->
    <div class="relative overflow-hidden aspect-[16/9] bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-800 dark:to-zinc-900">
      {{ with $item.Params.content_meta }}
        {{ if .trending }}
          <div class="absolute top-3 right-3 z-10 inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[11px] font-semibold bg-black/55 backdrop-blur-sm text-white shadow-sm">
            <span>{{ i18n "trending" | default "Trending" }}</span>
            <span aria-hidden="true">ðŸ”¥</span>
          </div>
        {{ end }}
      {{ end }}
      {{ with $resource }}
        {{ if ne .MediaType.SubType "gif" }}
          {{ $original_image := "" }}
          {{ if $fill_image }}
            {{ $original_image = .Fill (printf "800x450 %s" $anchor) }}
          {{ else }}
            {{ $original_image = .Fit (printf "800x450 %s" $anchor) }}
          {{ end }}
          {{ $responsive := partial "functions/process_responsive_image.html" (dict 
              "image" $original_image 
              "mode" "responsive"
              "sizes" (slice 400 600 800)
              "formats" (slice "avif" "webp" "jpg")
          ) }}
          <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block relative">
            <img class="w-full h-full transition-transform duration-500 ease-out group-hover:scale-105 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}" 
                 srcset="{{ $responsive.srcset }}"
                 sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                 src="{{ $responsive.fallback.RelPermalink }}" 
                 width="{{ $original_image.Width }}" 
                 height="{{ $original_image.Height }}"
                 loading="lazy" 
                 decoding="async"
                 {{ if eq $index 0 }}fetchpriority="high"{{ end }}
                 style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
                 alt="{{ $item.Title | plainify }} featured image">

            {{ with $hover }}
              <img class="absolute inset-0 w-full h-full opacity-0 transition-opacity duration-300 ease-out group-hover:opacity-100 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}" 
                   src="{{ .RelPermalink }}" 
                   width="{{ .Width }}" 
                   height="{{ .Height }}" 
                   loading="lazy" 
                   decoding="async" 
                   alt="">
            {{ end }}
          </a>
        {{ else }}
          <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block relative">
            <img class="w-full h-full transition-transform duration-500 ease-out group-hover:scale-105 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}"
                 src="{{ .RelPermalink }}"
                 width="{{ .Width }}"
                 height="{{ .Height }}"
                 loading="lazy"
                 decoding="async"
                 style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
                 alt="{{ $item.Title | plainify }} featured image">
            {{ with $hover }}
              <img class="absolute inset-0 w-full h-full opacity-0 transition-opacity duration-300 ease-out group-hover:opacity-100 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}" 
                   src="{{ .RelPermalink }}" 
                   width="{{ .Width }}" 
                   height="{{ .Height }}" 
                   loading="lazy" 
                   decoding="async" 
                   alt="">
            {{ end }}
          </a>
        {{ end }}
      {{ else }}
        <!-- Fallback gradient with subtle pattern -->
        <div class="w-full h-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center">
          <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
            <svg class="w-8 h-8 text-white/60" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
          </div>
        </div>
      {{end}}
      
      <!-- Subtle overlay for better text contrast (allow clicks to pass through) -->
      <div class="absolute inset-0 pointer-events-none bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
    </div>

    <!-- Content Section -->
    <div class="p-8 space-y-4">
      ... (rest of your card unchanged) ...
    </div>
</div>
